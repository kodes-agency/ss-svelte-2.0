<script lang="ts">
    import { onMount } from 'svelte';
    import { page } from '$app/stores';
    import type { ContactPage } from '../../../__generated__/graphql';
    import { isInverted } from '$lib/store/store';

    let markerSvgString = `
        <svg width="100" height="69" viewBox="0 0 100 69" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M19.5457 11.5071V10.5168C20.6357 10.1042 22.2832 9.60899 22.3997 9.58423C22.5412 9.55122 22.8075 9.57598 22.8075 9.71628V11.6639C24.2303 10.2362 25.4368 9.58423 26.2689 9.58423C28.1494 9.58423 29.0231 11.9363 29.0231 13.9004V21.2206C29.0231 21.6333 29.2894 22.2027 29.5973 22.2027H30.3794V23.3169H26.0859V22.2027H26.7349C27.076 22.2027 27.4588 21.5755 27.4588 21.2454V14.0077C27.4588 12.8276 27.0594 11.1523 25.2871 11.2595C24.2386 11.3256 23.3733 12.0436 22.8075 13.1412V21.2206C22.8075 21.6333 23.1736 22.2027 23.4814 22.2027H24.1471V23.3169H19.8702V22.2027H20.5192C20.8604 22.2027 21.2431 21.5755 21.2431 21.2454V12.2911C21.2431 11.8372 20.8853 11.5071 20.6274 11.5071H19.5374H19.5457ZM32.8923 19.8589V11.5732H31.2781V10.1619C31.8189 10.1784 32.3515 10.1949 32.8923 10.2114V6.91859L34.4816 5.88699V10.2362C35.6049 10.2362 36.7366 10.2857 37.8765 10.2197V11.5979L34.4816 11.6144V19.9745C34.4816 21.3527 35.1889 21.8809 36.0875 21.8809C36.5701 21.8809 37.0944 21.8479 37.785 21.526V22.7722C37.0028 23.127 36.1458 23.3251 35.0641 23.3251C34.8727 23.3251 34.2237 23.2426 33.6162 22.7722C32.9173 22.2357 32.8923 20.8493 32.8923 19.8507V19.8589ZM88.9166 1.67807V0.423655L91.9038 0.00276138C92.0869 -0.0219969 92.2782 0.118302 92.2782 0.481424V11.9775C93.5929 9.87308 95.0491 9.66676 95.8895 9.66676C97.77 9.66676 98.6437 11.9198 98.6437 13.8922V21.2124C98.6437 21.625 98.91 22.1945 99.2178 22.1945H100V23.3086H95.7064V22.1945H96.3555C96.6966 22.1945 97.0794 21.5673 97.0794 21.2372V14.2553C97.0794 13.0752 96.5302 11.3751 94.7495 11.4906C93.7011 11.5567 92.8357 12.3654 92.2699 13.463V21.2124C92.2699 21.625 92.636 22.1945 92.9439 22.1945H93.6096V23.3086H89.3327V22.1945H89.9817C90.3228 22.1945 90.7056 21.5673 90.7056 21.2372V2.6519C90.7056 1.93391 90.2812 1.67807 89.7237 1.67807H88.9H88.9166ZM72.5079 11.5401V10.4673C73.6562 10.2857 75.0125 9.55122 75.129 9.52646C75.337 9.47695 75.6199 9.59249 75.6199 9.96386V14.7175C76.0027 13.2567 76.3605 12.3984 76.8098 11.4411C77.3839 10.2114 78.0746 9.49346 78.7901 9.4852C79.7138 9.4852 80.0965 10.1372 80.1048 11.0367C80.1048 11.5649 79.1396 12.1674 78.8817 11.9693C78.7236 11.7877 78.449 11.7547 78.2077 11.7712C77.0095 11.8455 76.0027 15.0063 75.6282 16.8962V21.2124C75.6282 21.625 75.9943 22.1945 76.3022 22.1945H77.6918V23.3086H72.691V22.1945H73.34C73.6811 22.1945 74.0639 21.5673 74.0639 21.2372V12.3902C74.0639 11.994 73.6645 11.5401 73.2734 11.5401H72.5162H72.5079ZM1.07339 19.4876C1.07339 20.9731 2.50458 21.8891 3.92744 21.8891C6.51523 21.8891 7.2225 19.7929 7.20586 17.5317C7.18922 15.6995 6.6234 14.2801 4.08554 12.8853C1.80563 11.6227 0.357797 9.79881 0.357797 7.11666C0.357797 3.56796 2.48793 1.24068 5.84124 1.24068C6.74821 1.24068 8.1794 1.43875 8.78682 1.75235V6.62974H7.63854L7.54701 4.22818C7.50541 3.21309 6.41538 2.62715 5.45016 2.61064C3.65285 2.56938 2.24663 4.63257 2.24663 6.40692C2.24663 8.56914 2.85405 9.52647 5.33367 10.8717C7.69679 12.1591 9.15294 14.1728 9.15294 16.8137C9.15294 18.7861 8.83675 20.7668 7.33899 22.0542C6.16575 23.061 4.59311 23.3664 3.02879 23.3664C2.13014 23.3664 0.840406 22.9372 0 22.4751L0.0748877 17.4821C0.357797 17.4656 0.757197 17.4739 1.06507 17.4739V19.4876H1.07339ZM43.2268 17.2181L44.5748 17.0943V20.1313C44.3169 20.4201 43.7344 21.0556 43.4099 21.2372C42.6444 21.6663 41.6459 21.8726 41.0468 21.3774C40.2812 20.742 40.3645 18.9759 40.8554 18.3734C41.3962 17.705 42.3199 17.3006 43.2351 17.2263L43.2268 17.2181ZM44.6913 21.5343L44.7246 22.6236C44.7329 22.962 44.9492 23.1848 45.4319 23.1848H47.4621V22.0707H46.888C46.4137 22.0707 46.1225 21.6168 46.1225 21.0143V13.5456C46.1058 10.7974 44.6497 9.65851 43.0937 9.65851C41.3796 9.67502 40.1564 11.5814 39.4908 12.6378L40.2646 13.199C41.1549 11.8455 41.9454 11.1275 42.8524 11.1275C44.1421 11.1027 44.5748 12.0848 44.5748 13.1412V16.0049C42.8857 16.0709 40.5225 16.2772 39.3992 18.0598C38.6836 19.207 38.667 20.9896 39.3576 22.1202C39.8236 22.8794 40.6224 23.2508 41.6209 23.2426C42.2949 23.2426 42.8857 23.0445 43.5763 22.5411C43.8592 22.3348 44.3917 21.8809 44.683 21.526L44.6913 21.5343ZM14.4533 17.2181L15.8013 17.0943V20.1313C15.5434 20.4201 14.9609 21.0556 14.6364 21.2372C13.8709 21.6663 12.8724 21.8726 12.2733 21.3774C11.5077 20.742 11.5909 18.9759 12.0819 18.3734C12.6227 17.705 13.5463 17.3006 14.4616 17.2263L14.4533 17.2181ZM15.9178 21.5343L15.9511 22.6236C15.9594 22.962 16.1757 23.1848 16.6583 23.1848H18.6886V22.0707H18.1145C17.6402 22.0707 17.349 21.6168 17.349 21.0143V13.5456C17.3323 10.7974 15.8762 9.65851 14.3202 9.65851C12.6061 9.67502 11.3829 11.5814 10.7173 12.6378L11.4911 13.199C12.3814 11.8455 13.1719 11.1275 14.0789 11.1275C15.3686 11.1027 15.8013 12.0848 15.8013 13.1412V16.0049C14.1122 16.0709 11.749 16.2772 10.6257 18.0598C9.91014 19.207 9.89349 20.9896 10.5841 22.1202C11.0501 22.8794 11.8489 23.2508 12.8474 23.2426C13.5214 23.2426 14.1122 23.0445 14.8028 22.5411C15.0857 22.3348 15.6182 21.8809 15.9095 21.526L15.9178 21.5343ZM67.2741 17.2181L68.6221 17.0943V20.1313C68.3641 20.4201 67.7817 21.0556 67.4571 21.2372C66.6916 21.6663 65.6931 21.8726 65.094 21.3774C64.3285 20.742 64.4117 18.9759 64.9026 18.3734C65.4435 17.705 66.3671 17.3006 67.2824 17.2263L67.2741 17.2181ZM68.7386 21.5343L68.7718 22.6236C68.7802 22.962 68.9965 23.1848 69.4791 23.1848H71.5094V22.0707H70.9353C70.461 22.0707 70.1697 21.6168 70.1697 21.0143V13.5456C70.1531 10.7974 68.697 9.65851 67.141 9.65851C65.4269 9.67502 64.2037 11.5814 63.538 12.6378L64.3119 13.199C65.2022 11.8455 65.9927 11.1275 66.8997 11.1275C68.1894 11.1027 68.6221 12.0848 68.6221 13.1412V16.0049C66.9329 16.0709 64.5698 16.2772 63.4465 18.0598C62.7309 19.207 62.7143 20.9896 63.4049 22.1202C63.8709 22.8794 64.6697 23.2508 65.6682 23.2426C66.3422 23.2426 66.9329 23.0445 67.6236 22.5411C67.9065 22.3348 68.439 21.8809 68.7302 21.526L68.7386 21.5343ZM53.761 19.4793C53.761 20.9648 55.1922 21.8809 56.6151 21.8809C59.2029 21.8809 59.9101 19.7847 59.8935 17.5234C59.8769 15.6913 59.311 14.2718 56.7732 12.8771C54.4933 11.6144 53.0454 9.79055 53.0454 7.1084C53.0454 3.55971 55.1756 1.23243 58.5289 1.23243C59.4358 1.23243 60.867 1.43049 61.4745 1.7441V6.62149H60.3262L60.2346 4.21993C60.193 3.20484 59.103 2.61889 58.1378 2.60239C56.3405 2.56112 54.9343 4.62432 54.9343 6.39866C54.9343 8.56089 55.5417 9.51821 58.0213 10.8634C60.3844 12.1508 61.8406 14.1645 61.8406 16.8054C61.8406 18.7778 61.5244 20.7585 60.0266 22.0459C58.8534 23.0528 57.2807 23.3581 55.7164 23.3581C54.8178 23.3581 53.528 22.929 52.6876 22.4668L52.7625 17.4739C53.0454 17.4574 53.4448 17.4656 53.7527 17.4656V19.4793H53.761ZM84.232 17.2098L85.58 17.086V20.123C85.322 20.4119 84.7396 21.0473 84.415 21.2289C83.6495 21.6581 82.651 21.8644 82.0519 21.3692C81.2864 20.7337 81.3696 18.9676 81.8605 18.3652C82.4014 17.6967 83.325 17.2923 84.2403 17.2181L84.232 17.2098ZM85.6965 21.526L85.7297 22.6154C85.7381 22.9537 85.9544 23.1766 86.437 23.1766H88.4673V22.0624H87.8932C87.4189 22.0624 87.1276 21.6085 87.1276 21.0061V13.5373C87.111 10.7891 85.6548 9.65026 84.0989 9.65026C82.3848 9.66676 81.1616 11.5732 80.4959 12.6295L81.2698 13.1907C82.1601 11.8372 82.9506 11.1193 83.8575 11.1193C85.1473 11.0945 85.58 12.0766 85.58 13.1329V15.9966C83.8908 16.0627 81.5277 16.269 80.4044 18.0516C79.6888 19.1987 79.6722 20.9813 80.3628 22.1119C80.8288 22.8712 81.6276 23.2426 82.6261 23.2343C83.3001 23.2343 83.8908 23.0363 84.5815 22.5328C84.8644 22.3265 85.3969 21.8726 85.6881 21.5177L85.6965 21.526Z" fill="#847748"/>
            <path d="M61 50.3133C61 59.0602 49.5 69 49.5 69C49.5 69 38 58.6627 38 50.3133C38 40.7711 43.5453 36 49.8966 36C56.2478 36 61 42.3614 61 50.3133Z" fill="#847748"/>
            <circle cx="49.5" cy="48.5" r="6.5" fill="#F5F3E4"/>
        </svg>
    `
    let map;

    $isInverted = false

    async function initMap() {
        // The location of Uluru
        const parser = new DOMParser();

        const position = { lat: 42.79225634956583, lng: 27.567548227983494 };


        // Request needed libraries.
        //@ts-ignore
        const { Map } = await google.maps.importLibrary("maps");
        const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");

        let pinSvg = parser.parseFromString(markerSvgString, "image/svg+xml").documentElement

        // The map, centered at Uluru
        map = new Map(document.getElementById("map"), {
            zoom: 13,
            center: position,
            mapId: "eec3baf5b39d9ce0",
        });

        // The marker, positioned at Uluru
        const marker = new AdvancedMarkerElement({
            map: map,
            position: position,
            content: pinSvg,
            title: "Hello World!",
        });
    }

    onMount(()=>{
        initMap();
    })

    let pageData: ContactPage
    $:pageData = $page.data.data.data.contactPage.data.attributes
</script>

<svelte:head >
    <script>
        (g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
            key: "AIzaSyBiC2VtbYqBF9LiGUlRqQVyZ8O_NtG0I74",
            v: "weekly",
        });
    </script>
</svelte:head>

<section class="py-10">
    <div class="min-h-screen flex flex-col space-y-14 items-center pt-40 ">
        <h1 class="text-center text-gray text-4xl font-serif">{pageData.heroHeading}</h1>
        <div class="flex w-full flex-col items-center space-y-4 md:space-y-0 md:items-start md:flex-row justify-around max-w-3xl">
            <div class="contacts-wrapper">
                <p class="text-center text-gray font-serif italic">{pageData.addressLine1}</p>
                <p class="text-center text-gray font-serif italic">{pageData.addressLine2}</p>
                <p class="text-center text-gray font-serif italic">{pageData.addressLine3}</p>
            </div>
            <div class="flex flex-col">
                <a title="Phone number link" aria-label="Phone number link" href="tel:{pageData.phoneNumber}" target="_blank">
                    <p class="text-center text-gray font-serif italic">{pageData.phoneNumber}</p>
                </a>
                <a title="Email link" aria-label="Email link" href="mailto:{pageData.email}" target="_blank">
                    <p class="text-center text-gray font-serif italic">{pageData.email}</p>
                </a>
                <p class="text-center text-gray font-serif italic">{pageData.website}</p>
                <div class="flex justify-center space-x-4">
                    <a title="Link to the facebook page" aria-label="Link to the facebook page" target="_blank" href="https://www.facebook.com/SantaSarahFamilyWineEstate/">           
                        <svg class="w-7 fill-brown" width="62" height="62" viewBox="0 0 62 62" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M61.4159 30.7278C61.4159 13.863 47.7517 0.19873 30.8869 0.19873C14.022 0.19873 0.357788 13.863 0.357788 30.7278C0.357788 45.9653 11.5218 58.5954 26.1167 60.8876V39.5529H18.3613V30.7278H26.1167V24.0016C26.1167 16.3508 30.6714 12.1248 37.6476 12.1248C40.9885 12.1248 44.4822 12.7206 44.4822 12.7206V20.2297H40.6316C36.84 20.2297 35.657 22.5834 35.657 24.9974V30.7278H44.1239L42.7698 39.5529H35.657V60.8876C50.2519 58.5954 61.4159 45.9653 61.4159 30.7278Z"/>
                        </svg>
                    </a>
                    <a title="Link to the instagram page" aria-label="Link to the instagram page" target="_blank" href="https://www.instagram.com/santasarah_familywineestate/">
                        <svg class="w-7 fill-brown" width="62" height="62" viewBox="0 0 62 62" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M30.5359 14.8712C21.8726 14.8712 14.8848 21.859 14.8848 30.5223C14.8848 39.1855 21.8726 46.1733 30.5359 46.1733C39.1991 46.1733 46.1869 39.1855 46.1869 30.5223C46.1869 21.859 39.1991 14.8712 30.5359 14.8712ZM30.5359 40.6975C24.9375 40.6975 20.3607 36.1343 20.3607 30.5223C20.3607 24.9102 24.9239 20.347 30.5359 20.347C36.1479 20.347 40.7111 24.9102 40.7111 30.5223C40.7111 36.1343 36.1343 40.6975 30.5359 40.6975ZM50.4777 14.231C50.4777 16.2606 48.8431 17.8816 46.8271 17.8816C44.7976 17.8816 43.1766 16.247 43.1766 14.231C43.1766 12.215 44.8112 10.5805 46.8271 10.5805C48.8431 10.5805 50.4777 12.215 50.4777 14.231ZM60.8436 17.936C60.6121 13.0459 59.4951 8.71432 55.9127 5.1455C52.3438 1.57668 48.0122 0.459724 43.1221 0.214538C38.0822 -0.0715126 22.976 -0.0715126 17.936 0.214538C13.0596 0.446103 8.72794 1.56306 5.1455 5.13188C1.56306 8.7007 0.459724 13.0323 0.214538 17.9224C-0.0715126 22.9624 -0.0715126 38.0685 0.214538 43.1085C0.446103 47.9986 1.56306 52.3302 5.1455 55.899C8.72794 59.4678 13.0459 60.5848 17.936 60.83C22.976 61.116 38.0822 61.116 43.1221 60.83C48.0122 60.5984 52.3438 59.4815 55.9127 55.899C59.4815 52.3302 60.5984 47.9986 60.8436 43.1085C61.1297 38.0685 61.1297 22.976 60.8436 17.936ZM54.3326 48.5162C53.2701 51.186 51.2133 53.2428 48.5298 54.3189C44.5115 55.9126 34.9765 55.5449 30.5359 55.5449C26.0953 55.5449 16.5467 55.899 12.542 54.3189C9.87215 53.2565 7.81531 51.1996 6.73921 48.5162C5.1455 44.4979 5.51328 34.9629 5.51328 30.5223C5.51328 26.0817 5.15912 16.533 6.73921 12.5283C7.80169 9.85852 9.85852 7.80169 12.542 6.72559C16.5603 5.13188 26.0953 5.49966 30.5359 5.49966C34.9765 5.49966 44.5251 5.1455 48.5298 6.72559C51.1996 7.78806 53.2565 9.8449 54.3326 12.5283C55.9263 16.5467 55.5585 26.0817 55.5585 30.5223C55.5585 34.9629 55.9263 44.5115 54.3326 48.5162Z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
        <div class="w-full h-96 grayscale-[30%]" id="map">
            
        </div>
    </div>
</section>